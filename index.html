<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Teacher Assistant | KR-VN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://unpkg.com/tesseract.js@v5.0.2/dist/tesseract.min.js'></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4">
    <div class="max-w-md mx-auto space-y-6">
        <header class="text-center py-4">
            <h1 class="text-3xl font-black text-emerald-400">AI TEACHER ğŸ“</h1>
            <p class="text-slate-400 text-sm">For My Vietnamese Student (KR Study)</p>
        </header>

        <section class="bg-slate-800 p-4 rounded-2xl shadow-xl border border-slate-700">
            <input type="password" id="apiKey" placeholder="Enter Groq API Key" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-sm focus:outline-none focus:border-emerald-500 mb-2">
            <select id="modelSelect" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-sm focus:outline-none">
                <option value="llama-3.3-70b-versatile">Llama 3.3 70B (Best Intelligence)</option>
                <option value="llama-3.1-8b-instant">Llama 3.1 8B (Fastest)</option>
            </select>
        </section>

        <section class="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 text-center">
            <label class="block mb-4 cursor-pointer">
                <div class="bg-emerald-600 hover:bg-emerald-500 p-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all">
                    <span>ğŸ“¸ ì‚¬ì§„ ì°ê¸° / ì—…ë¡œë“œ</span>
                </div>
                <input type="file" id="imageInput" accept="image/*" capture="environment" class="hidden">
            </label>
            <canvas id="canvas" class="hidden w-full rounded-lg mb-4 border border-slate-600"></canvas>
            <div id="ocrStatus" class="text-xs text-slate-500 mt-2">ëŒ€ê¸° ì¤‘...</div>
        </section>

        <section class="bg-slate-800 p-4 rounded-2xl shadow-xl border border-slate-700">
            <textarea id="rawContent" rows="4" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-sm text-slate-300 focus:outline-none" placeholder="ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤..."></textarea>
            <button onclick="generateQuiz()" id="genBtn" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 p-4 rounded-xl font-bold transition-all disabled:opacity-50">
                DAILY QUIZ 10 ìƒì„± ğŸš€
            </button>
        </section>

        <div id="quizResult" class="space-y-4 pb-10"></div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const ocrStatus = document.getElementById('ocrStatus');
        const rawContent = document.getElementById('rawContent');
        const quizResult = document.getElementById('quizResult');

        // 1. ì´ë¯¸ì§€ ì„ íƒ ì‹œ ì¦‰ì‹œ OCR ì‹¤í–‰
        imageInput.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            ocrStatus.innerText = "í…ìŠ¤íŠ¸ë¥¼ ì½ëŠ” ì¤‘... (Wait a sec)";
            ocrStatus.className = "text-xs text-yellow-400 mt-2";

            try {
                const result = await Tesseract.recognize(file, 'kor+eng', {
                    logger: m => console.log(m)
                });
                rawContent.value = result.data.text;
                ocrStatus.innerText = "ë¶„ì„ ì™„ë£Œ!";
                ocrStatus.className = "text-xs text-emerald-400 mt-2";
            } catch (err) {
                console.error(err);
                ocrStatus.innerText = "OCR ì—ëŸ¬ ë°œìƒ";
                ocrStatus.className = "text-xs text-red-400 mt-2";
            }
        };

        // 2. Groq APIë¡œ í€´ì¦ˆ ìƒì„±
        async function generateQuiz() {
            const key = document.getElementById('apiKey').value || localStorage.getItem('groq_key');
            const content = rawContent.value;
            const model = document.getElementById('modelSelect').value;

            if (!key || !content) return alert("Keyì™€ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”!");
            localStorage.setItem('groq_key', key);

            const btn = document.getElementById('genBtn');
            btn.innerText = "AI ìƒê° ì¤‘...";
            btn.disabled = true;
            quizResult.innerHTML = '';

            const systemPrompt = `You are a Korean teacher for Vietnamese students. Based on the textbook text, generate 10 quizzes.
            Format: JSON { "questions": [{ "q": "Korean (Vietnamese translation)", "options": ["1","2","3","4"], "a": 0, "exp": "Explanation in Vietnamese" }] }
            Ensure the tone is kind and helpful (KÃ­nh ngá»¯).`;

            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: `Textbook content: ${content}` }
                        ],
                        response_format: { type: "json_object" },
                        temperature: 0.7
                    })
                });

                const data = await res.json();
                const json = JSON.parse(data.choices[0].message.content);
                render(json.questions);
            } catch (err) {
                console.error(err);
                alert("Groq í˜¸ì¶œ ì—ëŸ¬!");
            } finally {
                btn.innerText = "DAILY QUIZ 10 ìƒì„± ğŸš€";
                btn.disabled = false;
            }
        }

        function render(questions) {
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = "bg-slate-800 p-5 rounded-2xl border-l-4 border-emerald-500 shadow-lg";
                div.innerHTML = `
                    <p class="font-bold text-lg mb-3 leading-snug">${i+1}. ${q.q}</p>
                    <div class="grid grid-cols-1 gap-2 mb-4">
                        ${q.options.map((opt, idx) => `<button class="text-left p-3 rounded-lg bg-slate-900 hover:bg-slate-700 text-sm transition-colors border border-slate-700">${idx+1}. ${opt}</button>`).join('')}
                    </div>
                    <details class="group">
                        <summary class="text-sm text-emerald-400 cursor-pointer font-semibold list-none">ì •ë‹µ ë° ë² íŠ¸ë‚¨ì–´ í•´ì„¤ ë³´ê¸°</summary>
                        <div class="mt-3 text-sm text-slate-400 bg-slate-900 p-3 rounded-lg border-t border-emerald-500/30">
                            <span class="text-emerald-400 font-bold">ì •ë‹µ: ${q.options[q.a]}</span><br>
                            ${q.exp}
                        </div>
                    </details>
                `;
                quizResult.appendChild(div);
            });
        }

        // í‚¤ ìë™ ë¡œë“œ
        document.getElementById('apiKey').value = localStorage.getItem('groq_key') || '';
    </script>
</body>
</html>
